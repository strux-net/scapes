# Autogenerated makefile
# by :
#   m_tru mTR >makefile
#
m_diff=bash -c 'if ! diff -a -q $$1 ok/$$1 >/dev/null ; then echo -e "BAD\t$$1\tok/$$1" ; else echo -e "GOOD\t$$1" ; fi ; ' m_diff
m_copy=bash -c 'if ! diff -a -q $$1 $$2    >/dev/null ; then echo copying $$1 $$2; cp -p $$1 $$2 ; fi ; ' m_copy
ALL:\
  session.vim\

install install_ALL:\
  install_session.vim\

test test_ALL:\
  test_session.vim\

logged_build:
	-@${MAKE} -B --no-print-directory ALL test_ALL 2>&1 | perl -pe 's,$$ENV{HOME}/,~/,g' >m.log # substitute /home/username with ~  (to avoid test-fails for trivial reasons)
	@${m_diff} m.log
confirmed_install: confirm install
confirm:
	@bash -c 'read -p "really install ? (^C) if not"'
export Title=maintain vim-sessions
install_session.vim:
	@echo  installing session.vim
	@${m_copy} session.vim ok/session.vim
	@${m_copy} session.vim ~/.vim/plugin/
	@${m_copy} docs/README.txt ok/docs/README.txt
	@${m_copy} docs/README.html ok/docs/README.html
	@${m_copy} docs/session-commands.txt ok/docs/session-commands.txt
	vim -u NONE -c 'helptags ~/.vim/doc' -c q
test_session.vim: session.vim
	@: # an empty action. To avoid nothing to be done for test_whatever
session.vim:
	@echo  building session.vim
	vim_tru session.vimTR >session.vim
	@${m_diff} session.vim
	{ echo "session.vim\n  maintain vim-sessions\n    usage"; < session.vim perl -na -e 'if ($$seq = (/^"usage for / .. /"--/) and $$seq !~ /E0/ and $$seq>1) { s/.//;s/^\s+$$/\n/;print }' ; } >docs/README.txt
	@${m_diff} docs/README.txt
	{ sed "s/^    usage$$/    code/" docs/README.txt ; echo "style\n  Title\tmaintain vim-sessions" ; } | html_tru >docs/README.html
	@${m_diff} docs/README.html
	Title="*session.txt*   maintain vim-sessions" vimInterface2Help_tru session.vimTR >docs/session-commands.txt
	@${m_diff} docs/session-commands.txt
