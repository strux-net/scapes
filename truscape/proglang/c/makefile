# Autogenerated makefile
# by :
#   m_tru mTR >makefile
#
m_diff=bash -c 'if ! diff -a -q $$1 ok/$$1 >/dev/null ; then echo -e "BAD\t$$1\tok/$$1" ; else echo -e "GOOD\t$$1" ; fi ; ' m_diff
m_copy=bash -c 'if ! diff -a -q $$1 $$2    >/dev/null ; then echo copying $$1 $$2; cp -p $$1 $$2 ; fi ; ' m_copy
ALL:\
  c_tru\

install install_ALL:\
  install_c_tru\

test test_ALL:\
  test_c_tru\

logged_build:
	-@${MAKE} -B --no-print-directory ALL test_ALL 2>&1 | perl -pe 's,$$ENV{HOME}/,~/,g' >m.log # substitute /home/username with ~  (to avoid test-fails for trivial reasons)
	@${m_diff} m.log
confirmed_install: confirm install
confirm:
	@bash -c 'read -p "really install ? (^C) if not"'
export Title=convert .cTR to .c
install_c_tru:
	@echo  installing c_tru
	@${m_copy} statistics.out ok/statistics.out
	@${m_copy} c_tru ok/c_tru
	@${m_copy} ctest.cc ok/ctest.cc
	@${m_copy} ctest4.c ok/ctest4.c
	@${m_copy} ctest1.c ok/ctest1.c
	@${m_copy} ctest2.c ok/ctest2.c
	@${m_copy} ctest3.c ok/ctest3.c
	@${m_copy} docs/README.txt ok/docs/README.txt
	@${m_copy} docs/README.html ok/docs/README.html
	@${m_copy} docs/c_tru.html ok/docs/c_tru.html
	@${m_copy} c_tru ~/strux/bin/c_tru
test_c_tru: c_tru
	@echo  testing c_tru
	./c_tru ctest.ccTR >ctest.cc
	@${m_diff} ctest.cc
	./c_tru  -languageType cpp -noMark  -intro ./intro -noProtos ctest.ccTR >ctest4.c
	@${m_diff} ctest4.c
	./c_tru  -languageType cpp -noIntro -use_printf            ctest.ccTR >ctest1.c
	@${m_diff} ctest1.c
	./c_tru  -noMark                                           ctest.ccTR >ctest2.c
	@${m_diff} ctest2.c
	./c_tru  -noMark                 -noProtos                 ctest.ccTR >ctest3.c
	@${m_diff} ctest3.c
	-./c_tru  -noMark  -intro ./nofile intro
	-./c_tru  -invalid
	doxygen > doxygen.log
c_tru:
	@echo  building c_tru
	tru -s statistics.out ../common.tru ../morecommon.tru ../statementDelimiter.tru ../plainvar.tru c.tru ../c_like_vars.tru ../../lib/basicUSAGE.tru ccoll.tru >c_tru
	chmod +x c_tru # this is needed for trudocGivesCheck, else it finds the truer somewhere else
	PATH=$$PWD:$$PATH perl ~/bin/trudocGivesCheck -s c c_tru >c_tru.tmp
	mv c_tru.tmp c_tru
	chmod +x c_tru
	@${m_diff} statistics.out
	@${m_diff} c_tru
	{ echo "c_tru\n  convert .cTR to .c\n    usage"; ./c_tru -? 2>&1 | i -it 1 ; } >docs/README.txt
	@${m_diff} docs/README.txt
	{ sed "s/^    usage$$/    code/" docs/README.txt ; echo "style\n  Title\tconvert .cTR to .c" ; } | html_tru >docs/README.html
	@${m_diff} docs/README.html
	trudoc_tru ./c_tru >docs/c_tru.html
	@${m_diff} docs/c_tru.html
