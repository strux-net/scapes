# Autogenerated makefile
# by :
#   m_tru mTR >makefile
#
m_diff=bash -c 'if ! diff -a -q $$1 ok/$$1 >/dev/null ; then echo -e "BAD\t$$1\tok/$$1" ; else echo -e "GOOD\t$$1" ; fi ; ' m_diff
m_copy=bash -c 'if ! diff -a -q $$1 $$2    >/dev/null ; then echo copying $$1 $$2; cp -p $$1 $$2 ; fi ; ' m_copy
ALL:\
  isel\

install install_ALL:\
  install_isel\

test test_ALL:\
  test_isel\

logged_build:
	-@${MAKE} -B --no-print-directory ALL test_ALL 2>&1 | perl -pe 's,$$ENV{HOME}/,~/,g' >m.log # substitute /home/username with ~  (to avoid test-fails for trivial reasons)
	@${m_diff} m.log
confirmed_install: confirm install
confirm:
	@bash -c 'read -p "really install ? (^C) if not"'
export Title=select lines of structured text
install_isel:
	@echo  installing isel
	@${m_copy} isel ok/isel
	@${m_copy} statistics.out ok/statistics.out
	@${m_copy} docs/README.txt ok/docs/README.txt
	@${m_copy} docs/README.html ok/docs/README.html
	@${m_copy} isel ~/strux/bin/isel
test_isel: isel
	@echo  testing isel
	./isel /ba/i   -h                  test.in test1.in
	./isel ^a$$     -n 1                test.in
	./isel ^ba$$    -n 1                test.in
	./isel b -l 3  -n 1                test.in
	./isel b -l 3                      test.in
	./isel b -l 3       -nh            test.in
	./isel b -l 3       -ni            test.in
	./isel b -l 3           -indicate  test.in
	./isel ba      -n 1 -w             test.in
	./isel /ba/i                       test.in
	./isel baa              -tree      test.in
	./isel -f 1 cd          -tree      test.in
	-./isel -invalid
isel:
	@echo  building isel
	tru -s statistics.out isel.tru >isel
	@${m_diff} isel
	@${m_diff} statistics.out
	chmod +x isel
	{ echo "isel\n  select lines of structured text\n    usage"; ./isel -? 2>&1 | i -it 1 ; } >docs/README.txt
	@${m_diff} docs/README.txt
	{ sed "s/^    usage$$/    code/" docs/README.txt ; echo "style\n  Title\tselect lines of structured text" ; } | html_tru >docs/README.html
	@${m_diff} docs/README.html
