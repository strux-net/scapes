# Autogenerated makefile
# by :
#   m_tru mTR >makefile
#
m_diff=bash -c 'if ! diff -a -q $$1 ok/$$1 >/dev/null ; then echo -e "BAD\t$$1\tok/$$1" ; else echo -e "GOOD\t$$1" ; fi ; ' m_diff
m_copy=bash -c 'if ! diff -a -q $$1 $$2    >/dev/null ; then echo copying $$1 $$2; cp -p $$1 $$2 ; fi ; ' m_copy
ALL:\
  xtractStructure.pl\
  trudoc_tru\

install install_ALL:\
  install_xtractStructure.pl\
  install_trudoc_tru\

test test_ALL:\
  test_xtractStructure.pl\
  test_trudoc_tru\

logged_build:
	-@${MAKE} --no-print-directory ALL test_ALL 2>&1 | perl -pe 's,$$ENV{HOME}/,~/,g' >m.log # substitute /home/username with ~  (to avoid test-fails for trivial reasons)
	@${m_diff} m.log
confirmed_install: confirm install
confirm:
	@bash -c 'read -p "really install ? (^C) if not"'
export Title=produces html-documentation for a truer
install_xtractStructure.pl:
	@echo  installing xtractStructure.pl
	@${m_copy} xtractStructure.pl ok/xtractStructure.pl
	@${m_copy} xtractStructure.pl ~/strux/lib
	
test_xtractStructure.pl: xtractStructure.pl
	@: # an empty action. To avoid nothing to be done for test_whatever
.PHONY: xtractStructure.pl
xtractStructure.pl:
	@echo  building xtractStructure.pl
	perl_tru xtractStructure.plTR >xtractStructure.pl
	@${m_diff} xtractStructure.pl
	chmod +x xtractStructure.pl
install_trudoc_tru:
	@echo  installing trudoc_tru
	@${m_copy} trudoc_tru ok/trudoc_tru
	@${m_copy} statistics.out ok/statistics.out
	@${m_copy} docs/README.txt ok/docs/README.txt
	@${m_copy} docs/README.html ok/docs/README.html
	@${m_copy} doc.out ok/doc.out
	@${m_copy} trudoc_tru ok/trudoc_tru
	@${m_copy} docs/trudoc_tru.html ok/docs/trudoc_tru.html
	@${m_copy} trudoc_tru ~/strux/bin/trudoc_tru
test_trudoc_tru: trudoc_tru
	@echo  testing trudoc_tru
	./trudoc_tru -doc  >doc.out
	@${m_diff} doc.out
	PATH=$$PWD:$$PATH perl ~/bin/trudocGivesCheck -s c ./trudoc_tru >trudoc_tru.tmp
	mv trudoc_tru.tmp trudoc_tru
	chmod +x trudoc_tru
	@${m_diff} trudoc_tru
	./trudoc_tru ./trudoc_tru >docs/trudoc_tru.html
	@${m_diff} docs/trudoc_tru.html
.PHONY: trudoc_tru
trudoc_tru:
	@echo  building trudoc_tru
	tru -s statistics.out trudoc.tru ../lib/html.tru >trudoc_tru
	@${m_diff} trudoc_tru
	@${m_diff} statistics.out
	chmod +x trudoc_tru
	{ echo "trudoc_tru\n  $$Title\n    usage"; ./trudoc_tru -? 2>&1 | i -it 1 ; } >docs/README.txt
	@${m_diff} docs/README.txt
	sed "s/^    usage$$/    code/" docs/README.txt | html_tru >docs/README.html
	@${m_diff} docs/README.html
