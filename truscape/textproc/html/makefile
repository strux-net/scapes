# Autogenerated makefile
# by :
#   m_tru mTR >makefile
#
m_diff=bash -c 'if ! diff -a -q $$1 ok/$$1 >/dev/null ; then echo -e "BAD\t$$1\tok/$$1" ; else echo -e "GOOD\t$$1" ; fi ; ' m_diff
m_copy=bash -c 'if ! diff -a -q $$1 $$2    >/dev/null ; then echo copying $$1 $$2; cp -p $$1 $$2 ; fi ; ' m_copy
ALL:\
  html_tru\

install install_ALL:\
  install_html_tru\

test test_ALL:\
  test_html_tru\

logged_build:
	-@${MAKE} --no-print-directory ALL test_ALL 2>&1 | perl -pe 's,$$ENV{HOME}/,~/,g' >m.log # substitute /home/username with ~  (to avoid test-fails for trivial reasons)
	@${m_diff} m.log
confirmed_install: confirm install
confirm:
	@bash -c 'read -p "really install ? (^C) if not"'
export Title=convert .txtTR to html
install_html_tru:
	@echo  installing html_tru
	@${m_copy} html_tru ok/html_tru
	@${m_copy} statistics.out ok/statistics.out
	@${m_copy} testwithjs.html ok/testwithjs.html
	@${m_copy} test1.html ok/test1.html
	@${m_copy} test1nostyle.html ok/test1nostyle.html
	@${m_copy} docs/README.txt ok/docs/README.txt
	@${m_copy} docs/README.html ok/docs/README.html
	@${m_copy} docs/html_tru.html ok/docs/html_tru.html
	@${m_copy} html_tru ~/strux/bin/html_tru
test_html_tru: html_tru
	@echo  testing html_tru
	: expect 1 warning
	./html_tru -allowP testwithjs.txtTR >testwithjs.html
	@${m_diff} testwithjs.html
	./html_tru style ../test.txtTR >test1.html
	@${m_diff} test1.html
	./html_tru       ../test.txtTR >test1nostyle.html
	@${m_diff} test1nostyle.html
	./html_tru -show_vars
	-./html_tru -invalid
.PHONY: html_tru
html_tru:
	@echo  building html_tru
	tru -s statistics.out ../../proglang/common.tru ../../proglang/statementDelimiter.tru ../../proglang/plainvar.tru ../../proglang/js/js.tru ../../proglang/c_like_vars.tru ../../lib/style.tru ../common.tru html.tru ../../lib/htmlREAD.tru ../../lib/basicUSAGE.tru >html_tru
	@${m_diff} html_tru
	@${m_diff} statistics.out
	chmod +x html_tru
	{ echo "html_tru\n  convert .txtTR to html\n    usage"; ./html_tru -? 2>&1 | i -it 1 ; } >docs/README.txt
	@${m_diff} docs/README.txt
	{ sed "s/^    usage$$/    code/" docs/README.txt ; echo "style\n  Title\tconvert .txtTR to html" ; } | html_tru >docs/README.html
	@${m_diff} docs/README.html
	trudoc_tru -noGives ./html_tru >docs/html_tru.html
	@${m_diff} docs/html_tru.html
